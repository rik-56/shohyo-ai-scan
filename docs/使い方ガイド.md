# 仕訳アシスタント 使い方ガイド
## スマホで簡単！レシートをAIで自動仕訳

---

## はじめに

このアプリは、レシートや領収書の写真を撮るだけで、AIが自動的に仕訳データを作成してくれるツールです。
確定申告や経理作業の手間を大幅に減らせます。

**アプリURL:** https://shohyo-ai-scan.vercel.app/

---

## 目次

1. [アプリをスマホに追加する](#1-アプリをスマホに追加する)
2. [初期設定（APIキーの登録）](#2-初期設定apiキーの登録)
3. [AIモデルを選択する](#3-aiモデルを選択する)
4. [マスタ設定を行う](#4-マスタ設定を行う)
5. [レシートを読み取る](#5-レシートを読み取る)
6. [AIおまかせモード](#6-aiおまかせモード)
7. [読み取り結果を確認・修正する](#7-読み取り結果を確認修正する)
8. [データを保存・出力する](#8-データを保存出力する)
9. [トラブルシューティング](#9-トラブルシューティング)
10. [よくある質問](#10-よくある質問)

---

## 1. アプリをスマホに追加する

ブラウザで毎回URLを入力するのは面倒なので、ホーム画面に追加しましょう。

### iPhoneの場合

1. Safariでアプリを開く
2. 画面下の「共有」ボタン（四角から矢印が出ているマーク）をタップ
3. 「ホーム画面に追加」をタップ
4. 「追加」をタップ

### Androidの場合

1. Chromeでアプリを開く
2. 右上の「︙」（メニュー）をタップ
3. 「ホーム画面に追加」をタップ
4. 「追加」をタップ

これでホーム画面にアイコンが追加され、アプリのように使えます。

---

## 2. 初期設定（APIキーの登録）

AIでレシートを読み取るには、Google Gemini APIキーが必要です（無料）。

### APIキーの取得方法

1. **Googleアカウントでログイン**した状態で以下のページを開く

   https://aistudio.google.com/app/apikey

2. **「APIキーを作成」** をタップ

3. 表示された長い文字列（APIキー）を **長押しでコピー**

### アプリにAPIキーを登録

1. アプリを開く
2. 上部の **「マスタ設定」** タブをタップ
3. **「Gemini APIキー」** の入力欄にコピーしたキーを貼り付け
4. 自動的に保存されます

> **注意:** APIキーは他の人に教えないでください。あなた専用のキーです。

---

## 3. AIモデルを選択する

マスタ設定タブの「AIモデル選択」で、使用するモデルを選べます。

| モデル | 特徴 |
|--------|------|
| **Gemini 3 Flash** | 無料・最新・高速（おすすめ） |
| Gemini 2.5 Flash | 無料・高速・安定版 |
| Gemini 2.5 Flash-Lite | 無料・最速 |
| Gemini 2.5 Pro | 有料・高精度 |
| Gemini 3 Pro | 有料・最新・最高精度 |

デフォルトは **Gemini 3 Flash** で、おすすめとして表示されます。
より高い精度が必要な場合は、有料モデルをお試しください。

---

## 4. マスタ設定を行う

マスタ設定タブでは、会社ごとの勘定科目や補助科目を設定できます。

### 元帳補助科目の設定

会社ごとに、元帳種別に応じた補助科目を複数登録できます。

| 元帳種別 | 補助科目の例 |
|---------|------------|
| 現金 | 小口現金、本社現金など |
| 短期借入金 | 役員借入金など |
| 普通預金 | 三菱UFJ銀行、みずほ銀行など |
| 未払金 | JCBカード、VISAカードなど |

#### 設定手順

1. **「設定」タブ** を開く
2. **「元帳補助科目」** セクションで会社を選択
3. 各元帳種別の **「追加」** ボタンをタップ
4. 補助科目名を入力してEnterキーまたは追加ボタンをタップ

> **ポイント:** 現金と短期借入金は別々の補助科目リストを持っています。スキャン時に「現金」「短期借入金」ボタンで切り替えると、対応する補助科目リストが自動的に表示されます。

### 勘定科目の設定

よく使う勘定科目を追加・削除できます。

1. **「勘定科目マスタ」** セクションで会社を選択
2. 勘定科目をクリックして展開
3. **「補助科目を追加」** で補助科目を登録

### 設定のバックアップ（エクスポート/インポート）

設定データをファイルに保存・復元できます。機種変更やブラウザのキャッシュクリア前にバックアップしておくと安心です。

#### エクスポート（保存）

1. **「設定」タブ** を開く
2. 画面下部の **「データバックアップ」** セクションへ移動
3. **「エクスポート」** ボタンをタップ
4. JSONファイルがダウンロードされます

**保存されるデータ:**
- Gemini APIキー
- AIモデル設定
- カスタム税区分
- クライアント（会社）一覧
- 勘定科目マスタ（会社別・補助科目含む）

#### インポート（復元）

1. **「設定」タブ** を開く
2. **「インポート」** ボタンをタップ
3. 保存しておいたJSONファイルを選択
4. 確認ダイアログで **「OK」** をタップ

> **ポイント:** インポートは **マージ方式** です。既存のデータは消えず、インポートファイルのデータが追加されます。
>
> | 現在のアプリ | インポートファイル | 結果 |
> |-------------|-------------------|------|
> | A社, B社 | A社, C社 | A社, B社, C社 |
> | 税区分: X | 税区分: X, Y | 税区分: X, Y |
>
> ※ 同名会社の勘定科目はインポートファイルの内容で上書きされます。

---

## 5. レシートを読み取る

### 基本の使い方

1. **「スキャン」タブ** を開く（最初から開いています）

2. **元帳の種類** を選択する（「現金」「預金」「クレカ」）

### 元帳種別の違い

| 種別 | 用途 | 貸方科目 | 税区分 | インボイス |
|------|------|---------|-------|-----------|
| 現金 | 現金払いレシート | 現金 or 短期借入金 | AI判定 | AI判定 |
| 預金 | 銀行引き落とし | 普通預金 | 対象外 | 非適格 |
| クレカ | カード払い | 未払金 | 対象外 | 非適格 |

**なぜ預金・クレカは「対象外」「非適格」？**
→ 銀行明細やカード明細は適格請求書ではないため、証憑としてはインボイス非対応となります。

**現金の追加オプション:**
- 「現金」：通常の現金出納
- 「短期借入金」：立替払い（役員立替など）

3. 画面中央の **点線の枠** をタップ

4. **「写真を撮る」** または **「ファイルを選択」** を選ぶ
   - 写真を撮る → カメラが起動してレシートを撮影
   - ファイルを選択 → 保存済みの画像を選ぶ

5. 画像が表示されたら **「Gemini AIで解析」** ボタンをタップ

6. 数秒待つと、読み取り結果が表示されます

> **ポイント:** 預金・クレカを選んだ場合、AI解析後に税区分が自動的に「対象外」、インボイス区分が「非適格」に設定されます。これは銀行明細やクレジットカード明細は適格請求書ではないためです。

### 読み取れるもの

- レシート・領収書の写真
- PDFファイル（請求書など）
- CSVファイル（銀行明細など）

### PDF処理モード

PDFファイルをアップロードすると、処理モードを選択できます。

| モード | 説明 | おすすめ用途 |
|-------|------|-------------|
| **一括処理**（デフォルト） | PDFを一度に解析 | 通常のPDF、レート制限を回避したい場合 |
| ページ分割 | ページごとに分割して解析 | 大容量PDF（通帳など多ページ） |

**一括処理**はAPIへのリクエスト回数が少なくなるため、レート制限に引っかかりにくいです。
**ページ分割**は大容量PDFで精度が落ちる場合や、ページごとに結果を確認したい場合に便利です。

### コツ

- レシートは **明るい場所** で撮影する
- 文字が **はっきり見える** ように撮る
- 折り目やシワを伸ばしてから撮る

---

## 6. AIおまかせモード

勘定科目をAIに自動判定させる機能です。

### 有効化方法

1. スキャンタブで画像をアップロード
2. 「AI自動解析」ボタンの下にある **「AIおまかせモード」トグル** をONにする
3. 「AI自動解析」ボタンをクリックすると、AIが勘定科目を自動推測

### 判定ルール

| 取引内容 | 金額条件 | 勘定科目 |
|---------|---------|---------|
| 飲食（クライアントとの会食等） | 税抜20,000円以下 | 会議費 |
| 飲食（クライアントとの会食等） | 税抜20,000円超 | 接待交際費 |
| 手土産・贈答品 | 3,000円以上 | 接待交際費 |
| 交通費 | - | 旅費交通費 |
| 事務用品・文房具 | - | 消耗品費 |
| 判別不能な支出 | - | 仮払金 |
| 判別不能な収入 | - | 仮受金 |

### 注意点

- **学習ルールが優先**: 過去に手動で勘定科目を設定した取引先は、学習ルールが優先されます
- **手土産の判定**: レシートに「お土産」「贈答」等の文字がある場合のみ判定されます
- **判別できない場合**: 「仮払金」「仮受金」になるので、後から手動で修正してください

> **ポイント:** 学習ルールがある取引は、AIおまかせモードのON/OFFに関係なく自動的に勘定科目が設定されます。学習ルールがない取引のみ、OFFの場合は「仮払金」「仮受金」、ONの場合はAIが推測した科目になります。

---

## 7. 読み取り結果を確認・修正する

AIが読み取った結果は、表形式で表示されます。

### 表示される項目

| 項目 | 説明 |
|------|------|
| 日付 | 取引日（レシートの日付） |
| 摘要 | 取引内容（店名や品目） |
| 金額 | 支払った金額（支払=赤、入金=青で表示） |
| 勘定科目 | 経費の種類（消耗品費など）※支払=赤、入金=青で表示 |
| 税区分 | 消費税の区分（課税仕入10%、課税仕入8%、対象外など）- プルダウンから選択 |
| インボイス区分 | 適格/非適格の区分 - プルダウンから選択（未選択/適格/非適格） |

### 修正方法

1. 修正したい項目をタップ
2. 正しい内容を入力
3. 自動的に保存されます

### 取引を削除したい場合

- 各行の右端にある **ゴミ箱アイコン** をタップ
- 間違えて削除しても、画面下部に表示される通知の **「元に戻す」** ボタンで復活できます（5秒以内）

### 収入/支出を切り替えたい場合

- 金額の左にある **矢印アイコン** をタップすると切り替わります
- 切り替えた行は **黄色く強調表示** され、手動で変更したことがわかります
- もう一度タップして元に戻すと、強調表示も解除されます

---

## 8. データを保存・出力する

### 履歴に保存する

読み取った内容を後で使いたい場合：

1. **「履歴に保存」** ボタンをタップ
2. わかりやすい名前を入力（例：「2024年1月分レシート」）
3. **「保存」** をタップ

保存した履歴は画面下部の **「出力履歴」** に表示されます。

### CSVファイルを出力する

会計ソフト（Money Forwardなど）に取り込むためのファイルを作成：

1. **「CSV出力」** ボタンをタップ
2. ファイルが自動的にダウンロードされます

### 出力したファイルの場所

- **iPhone:** 「ファイル」アプリ → 「ダウンロード」フォルダ
- **Android:** 「ファイル」アプリ → 「ダウンロード」フォルダ

---

## 9. トラブルシューティング

### 「APIキーが無効です」と表示される

- APIキーが正しくコピーされているか確認してください
- キーの前後に空白が入っていないか確認してください
- Google AI Studioで新しいキーを発行してお試しください

### 「レート制限に達しました」と表示される

- 数分待ってから再試行してください
- 無料枠の上限に達した可能性があります（通常は翌日にリセット）
- 有料モデルを使用している場合は、課金状況を確認してください

### 読み取り結果が空になる

- 画像が不鮮明な可能性があります。明るい場所で撮り直してください
- PDFが画像ベースでない可能性があります（テキストPDFは対応、スキャン画像PDFも対応）
- ファイルサイズが大きすぎる場合、読み込みに失敗することがあります

### 金額が正しく読み取れない

- レシートの合計金額が見切れていないか確認してください
- 複数の金額がある場合、小計・税・合計が混在して誤認識されることがあります
- 読み取り後に手動で修正してください

### CSVファイルが文字化けする

- CSVファイルはUTF-8（BOM付き）で出力されます
- Excelで開く場合は「データ」→「テキストから」で「UTF-8」を選択してください
- Money Forwardへのインポートでは文字化けしません

### 「応答が長すぎて途中で切れました」と表示される

- 通帳PDFなど取引件数が多いファイルで発生することがあります
- **対処法1:** PDFのページ数を減らして分割アップロード
- **対処法2:** マスタ設定で **Gemini 2.5 Flash** に切り替える（出力上限が大きいため）
- **対処法3:** 有料モデル（Gemini 2.5 Pro等）を使用する

---

## 10. よくある質問

### Q. APIキーは有料ですか？

**A.** 無料で使えます。Googleが提供する無料枠の範囲内であれば課金されません。
個人利用であれば、ほぼ無料枠で収まります。

### Q. データはどこに保存されますか？

**A.** すべてのデータはあなたのスマホ（ブラウザ）内に保存されます。
インターネット上のサーバーには保存されないので、安心してご利用ください。

### Q. 読み取り精度が悪いときは？

**A.** 以下をお試しください：
- 写真を明るい場所で撮り直す
- レシートのシワを伸ばす
- マスタ設定でより高精度なモデル（Gemini 3 Pro等）を選択

### Q. 複数の会社の経理を管理できますか？

**A.** はい。画面上部のタブで会社（クライアント）を切り替えられます。
「＋」ボタンで新しい会社を追加できます。

### Q. スマホを変えたらデータは消えますか？

**A.** はい、現在はスマホ内にのみ保存されるため、機種変更するとデータは引き継がれません。
機種変更前に **設定タブの「エクスポート」** で設定をバックアップし、新しい端末で **「インポート」** すると復元できます。
取引データは **CSV出力** してバックアップしておくことをおすすめします。

### Q. オフラインで使えますか？

**A.** 画面の表示や過去の履歴閲覧はオフラインでも可能ですが、
AI解析にはインターネット接続が必要です。

### Q. 間違えて取引を削除してしまいました

**A.** 削除直後に画面下部に表示される緑色の通知の「元に戻す」ボタンをタップすると復活できます。
通知は5秒で消えるので、すぐにタップしてください。

### Q. タブを切り替えるとデータが消える？

**A.** いいえ、スキャンタブとマスタ設定タブを切り替えても、入力中のデータは保持されます。

---

## 更新履歴

- 2025年1月：PDF処理モードを簡素化（一括処理/ページ分割の2択に）
- 2025年1月：大容量PDF対応（出力トークン上限を拡大）
- 2025年1月：初版公開
